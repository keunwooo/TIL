출처

https://github.com/jonnung/cka-practice/blob/master/2-scheduling.md

## kubectl usages

**Create an NGINX Pod**

```
$ kubectl run nginx --image=nginx
```

**Generate POD Manifest YAML file (-o yaml). Don't create it(--dry-run)**

```
$ kubectl run nginx --image=nginx -o yaml --dry-run=client > nginx_pod.yaml
```

**Create a deployment**

```
$ kubectl create deployment nginx --image=nginx
```

**Generate Deployment YAML file (-o yaml). Don't create it(--dry-run)**

```
$ kubectl create deployment nginx --image=nginx -o yaml --dry-run=client
```

**Create a Service named redis-service of type ClusterIP to expose pod redis on port 6379**

```
$ kubectl expose pod redis --port=6379 --name redis-service --dry-run=client -o yaml
```

위 경우 자동으로 `redis` POD의 labels을 selector로 지정된다.

```
$ kubectl create service clusterip redis --tcp=6379:6379 -o yaml --dry-run=client
```

이렇게 Service를 만드는 경우 POD의 labels을 selectors에 지정되지 않지만 `app=redis`라는 labels을 추정하여 selectors로 지정된다.

**Create a Service named nginx of type NodePort to expose pod nginx's port 80 on port 30080 on the nodes:**

```
$ kubectl expose pod nginx --port=80 --name nginx-service --type=NodePort --dry-run=client -o yaml
# 이 명령어에서 NodePort는 적용되지 않는다. 
$ kubectl create service nodeport nginx --tcp=80:80 --node-port=30080 --dry-run=client -o yaml
```

위 두 명령어에서 하나는 NodePort를 지정할 수 없고, 하나는 selectors를 사용할 수 없다. 따라서 `expose` 명령어를 주로 사용하뒤 Definitions 파일을 통해 NodePort를 지정하는 것이 낫다.

```
kubectl run nginx --image=nginx -o yaml --dry-run=client

apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: nginx
  name: nginx
spec:
  containers:
  - image: nginx
    name: nginx
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
```



create service는 selectors를 사용할 수 없다.

```
kubectl create service nodeport nginx --tcp=80:80 --node-port=33333 --dry-run=client -o yaml

apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: nginx
  name: nginx
spec:
  ports:
  - name: 80-80
    nodePort: 33333
    port: 80
    protocol: TCP
    targetPort: 80
  selector:
    app: nginx
  type: NodePort
status:
  loadBalancer: {}

```

하나는 nodeport를 사용할수 없다고 나오는데 둘다 노트포트가 적용됨 뭐지?

```
kubectl expose pod nginx --port=80 --name nginx-service --type=NodePort --dry-run=client -o yaml > nginx-service.yaml

apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    run: nginx
  name: nginx-service
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
  selector:
    run: nginx
  type: NodePort
status:
  loadBalancer: {}
```

