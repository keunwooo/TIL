# Cluster Maintenance



### Os upgrade



유지관리를 위해 Node 를 제거해야함.

노드01의 Unscheduleable로 변경

Pod를 node01에서 evicted 한다.



```
kubectl drain node01 --ignore-daemonsets
```



The maintenance tasks have been completed. Configure the node `node01` to be schedulable again.

메인보수 작업이 끝난후 noed01에 다시 스케쥴 가능하게 만들기



```
kubectl uncordon node01
```



다시 스케줄 가능해졌다고 해서 기존 pod가 바로 적재되는 것은 아님.

노드에서 uncordon 명령을 실행하면 노드에서 포드가 자동으로 예약되지 않습니다. 새 포드가 생성되면 node01에 배치됩니다.



포드가 컨트롤플레인 노드에 배치된 이유는 무엇입니까?

```

```



 다시 다음 명령어를 실행하면 효과가 없다. why?

```
kubectl drain node01 --ignore-daemonsets
```

```
kubectl get pods -o wide 그러면 replicaset의 일부가 아닌 node01에 예약된 단일 포드가 있음을 알 수 있습니다.
이 경우 배수 명령이 작동하지 않습니다. 노드를 강제로 drain하려면 이제 --force 플래그를 사용해야 합니다.
```



레플리카셋의 일부가 아닌 node01에서 호스팅되는 POD의 이름은 무엇입니까?

```
kubectl get pod -o wide
```



node01이 강제로 drain되면 hr-app은 어떻게 됩니까?

```
kubectl drain node01 --ignore-daemonsets --force
```

-> 파드는 사라지고 영원히 찾을수 없게 된다.



앗! 우리는 그렇게하고 싶지 않았습니다! hr-app은 파괴되어서는 안되는 중요한 어플리케이션입니다. 

이제 이전 상태로 돌아가 hr-app을 배포로 다시 배포했습니다.



hr-app은 중요한 앱이며 우리는 이 앱이 제거되는 것을 원하지 않으며 node01에서 더 이상 포드를 예약하고 싶지 않습니다.
이 노드에서 새 포드가 예약되지 않도록 node01을 예약 불가능으로 표시합니다.

```
kubectl cordon node01
```

