 YAML 파일과 설정값을 분리할 수 있는 컨피그맵과 시크릿이라는 오브젝트를 제공

컨피그맵에는 설정값

시크릿에는 노출되어서는 안되는 비밀값



# Configmap



1. 네임스페이스별로 컨피그맵이 존재

단순 문자열을 사용해서 Config 생성하기

```
kubectl create configmap

kubectl create configmap log-level-configmap --from-literal LOG_LEVEL=DEBUG

kubectl create cpmfigamp start-k8s --from-literal k8s=kubernetes --from-literal container=docker
```



```
kubectl get configmap -o yaml

kubectl describe configmap
```



- 컨피그맵의 값을 컨테이너의 환경 변수로 사용

1. 모든 환경변수를 가져오기

```yaml
apiVersion: v1
kind: Pod
metadata:
 name: container-env-example
spec:
 containers:
  - name: my-container
    image: busybox
    args: ['tail','-f','/dev/null']
    envFrom:
    - configMapRef:
      name: log-level-configmap
    - configMapRef:
      name: start-k8s
      
```



결과적으로 총 3개의 환경변수를 등록



2. 컨피그맵에 존재하는 키-값 쌍 중에서 원하는 데이터만 선택적으로 가져오기

```
...
   env:
   - name: ENV_KEYNAME_1
     valueFrom:
      configMapKeyRef:
       name: log-level-configmap
       key: LOG_LEVEL
```



- 컨피그맵의 값을 포드 내부의 파일로 마운트해 사용

만약 애플리케이션이 nginx.conf mysql.conf 등 특정 파일로부터 설정값을 읽어온다면 컨피그맵의 데이터를 포드 내부의 파일로 마운트해 사용이 가능하다.

1. 모든 키,쌍 값 마운트

```
apiVersion: v1
kind: Pod
metadata:
 name: configmap-volume-pod
spec:
 containers:
  - name: my-container
    image: busybox
    args: ['tail','-f','/dev/null']
    volumeMounts:
    - name: configmap-volume
      mountPath: /etc/config
      
volumes:
 - name: configmap-volume
   configMap:
    name: start-k8s
```



컨피그맵의 모든 키-쌍 데이터가 마운트됨, 파일 이름은 키의 이름과 같음



2. 원하는 키-쌍 값만 선택해서 가져오기

```
apiVersion: v1
kind: Pod
metadata:
 name: configmap-volume-pod
spec:
 containers:
  - name: my-container
    image: busybox
    args: ['tail','-f','/dev/null']
    volumeMounts:
    - name: configmap-volume
      mountPath: /etc/config
      
volumes:
 - name: configmap-volume
   configMap:
    name: start-k8s
    items:               #컨피그맵에서 가져올 키-값의 목록을 나열
    - key: k8s           #k8s라는 키에 대응하는 값을 가져온다
      path: k8s_fullname #최종 파일 이름은 k8s-fullname이 된다 
                         #최종적으로 디렉터리에 위치할 파일의 이름을 입력하는 항목


```



파일로부터 컨피그맵 생성

```
echo Hello, world! >> index.html
kubectl create configmap index-file --from-file index.html
```

- 별도의 키를 지정하지 않으면 파일 이름이 키로, 파일이 내용이 값으로 저장



파일 내용에 해당하는 키의 이름을 직접 지정

```
kubectl create configmap index-file-customkey --from-file myindex.html
```



Config 파일 yaml로 사용하기

```
kubectl create configmap my-configmap --from-literal mykey=myvalue --dry-run -o yaml
```



# Secret

시크릿은 SSH 키 ,비밀번호 등과 같이 민감한 정보를 저장하기 위한 용도로 사용

시크릿과 컨피그맵은 사용방법이 매우 비슷

