# Thanos

초보자 사용법

https://hyunki1019.tistory.com/128?category=693849

tar.gz 압축 풀기 **tar -zxvf**



프로메테우스 다운로드

https://prometheus.io/download/



그라파나 다운로드

https://grafana.com/grafana/download



sudo service grafana-server start



타노스 다운로드

https://github.com/thanos-io/thanos/releases



프로메테우스 서버에 사이드카 설치 And 타노스 Queryer? 설치? 운영?

-----??

메트릭? 개념? 수집 개념? 아키텍처 이해



1단계 튜토리얼에서

프로메테우스 yml 설정파일 작성하고

프로메테우스 도커 디렉터리에서 사용할 디렉터리 생성하고

```
docker run -d --net=host --rm \
    -v $(pwd)/prometheus0_eu1.yml:/etc/prometheus/prometheus.yml \
    -v $(pwd)/prometheus0_eu1_data:/prometheus \
    -u root \
    --name prometheus-0-eu1 \
    quay.io/prometheus/prometheus:v2.14.0 \
    --config.file=/etc/prometheus/prometheus.yml \
    --storage.tsdb.path=/prometheus \
    --web.listen-address=:9090 \
    --web.external-url=https://2886795276-9090-cykoria03.environments.katacoda.com \
    --web.enable-lifecycle \
    --web.enable-admin-api && echo "Prometheus EU1 started!"
```



컨테이너 사망 원인..?이 뭐지



도커로 배포함.. 배포하고 접속되는지 확인( 나는 도커로 안하고 설치해서 사용 중..흠..)



2단계



타노스 사이드카 설치

타노스 사이드카 도커로 설치..하는듯?



배포 한 각 Prometheus 인스턴스에 사이드카를 설치

> 이 설정에서 사이드카에 필요한 유일한 구성은 Prometheus API URL 및 구성 파일에 대한 액세스입니다. 이전 버전에서는 Prometheus 메트릭에 액세스 할 수 있고 후자는 사이드카가 런타임에 Prometheus 구성을 다시로드 할 수 있도록 허용합니다.



타노스 도커 실행문 분석..

```
docker run -d --net=host --rm \
    -v $(pwd)/prometheus0_eu1.yml:/etc/prometheus/prometheus.yml \
    --name prometheus-0-sidecar-eu1 \
    -u root \
    quay.io/thanos/thanos:v0.18.0 \
    sidecar \
    --http-address 0.0.0.0:19090 \
    --grpc-address 0.0.0.0:19190 \
    --reloader.config-file /etc/prometheus/prometheus.yml \
    --prometheus.url http://127.0.0.1:9090 && echo "Started sidecar for Prometheus 0 EU1"
```



d, --detach=false: Detached 모드입니다. 보통 데몬 모드라고 부르며 컨테이너가 백그라운드로 실행됩니다.

-v, --volume=[]: 데이터 볼륨을 설정입니다. 호스트와 공유할 디렉터리를 설정하여 파일을 컨테이너에 저장하지 않고 호스트에 바로 저장합니다. 호스트 디렉터리 뒤에 **:ro**, **:rw**를 붙여서 읽기 쓰기 설정을 할 수 있으며 기본 값은 **:rw**입니다

--name=””: 컨테이너에 이름을 설정합니다.

-u, --user=””: 컨테이너가 실행될 리눅스 사용자 계정 이름 또는 UID를 설정합니다.

--net=”bridge”: 컨테이너의 네트워크 모드를 설정합니다.

- bridge: Docker 네트워크 브리지에 새 네트워크를 생성합니다.
- none: 네트워크를 사용하지 않습니다.
- container:<컨테이너 이름, ID>: 다른 컨테이너의 네트워크를 함께 사용합니다.
- host: 컨테이너 안에서 호스트의 네트워크를 그대로 사용합니다. 호스트 네트워크를 사용하면 D-Bus를 통하여 호스트의 모든 시스템 서비스에 접근할 수 있으므로 보안에 취약해집니다.



http://pyrasis.com/book/DockerForTheReallyImpatient/Chapter20/28 참고



```
docker run -d --net=host --rm \
    -v $(pwd)/prometheus0_eu1.yml:/etc/prometheus/prometheus.yml \
    --name prometheus-0-sidecar-eu1 \
    -u root \
    quay.io/thanos/thanos:v0.18.0 \
    sidecar \
    --http-address 0.0.0.0:19090 \
    --grpc-address 0.0.0.0:19190 \
    --reloader.config-file /etc/prometheus/prometheus.yml \
    --prometheus.url http://127.0.0.1:9090 && echo "Started sidecar for Prometheus 0 EU1"
```





외부레이블?조사