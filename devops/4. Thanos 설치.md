# Thanos



### Prometheus & Thanos

```
helm repo add bitnami https://charts.bitnami.com/bitnami

helm install prometheus-operator \
  --set prometheus.thanos.create=true \
  --set operator.service.type=ClusterIP \
  --set prometheus.service.type=ClusterIP \
  --set alertmanager.service.type=ClusterIP \
  --set prometheus.thanos.service.type=LoadBalancer \
  --set prometheus.externalLabels.cluster="data-producer-0" \
  bitnami/prometheus-operator

kubectl get svc | grep prometheus-operator-prometheus-thanos

helm install thanos bitnami/thanos \
  --values values.yaml

```

- --set prometheus.thanos.create=true 옵션으로 prometheus 설치 시 sidecar를 포함하게 만듬



### Values.yaml

```
querier:
 stores:
  - 10.2.0.14:31420
  - 10.2.0.248:32527
```

- 포트 번호는 kubectl get svc | grep prometheus-operator-prometheus-thanos 로 확인해서 기입



### Grafana

```
helm install grafana bitnami/grafana   --set service.type=LoadBalancer --set admin.password=GRAFANA-PASSWORD --set persistence.enabled=false
```

- PVC 가 없으므로 persistence.enabled 옵션을 false로 줌



---

k3s 에서 helm install 시 connection refused 발생 시

```
kubectl config view --raw >~/.kube/config
```